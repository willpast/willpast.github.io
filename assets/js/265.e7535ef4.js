(window.webpackJsonp=window.webpackJsonp||[]).push([[265],{596:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"为什么需要索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要索引"}},[s._v("#")]),s._v(" 为什么需要索引？")]),s._v(" "),a("p",[s._v("当你抱怨MongoDB集合查询效率低的时候，可能你就需要考虑使用索引了，为了方便后续介绍，先科普下MongoDB里的索引机制（同样适用于其他的数据库比如mysql）。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mongo-9552:PRIMARY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("gt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" db.person."),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ObjectId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"571b5da31b0d530a03b3ce82"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jack"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ObjectId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"571b5dae1b0d530a03b3ce83"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rose"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ObjectId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"571b5db81b0d530a03b3ce84"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jack"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ObjectId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"571b5dc21b0d530a03b3ce85"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tony"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ObjectId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"571b5dc21b0d530a03b3ce86"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"adam"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("当你往某各个集合插入多个文档后，每个文档在经过底层的存储引擎持久化后，会有一个位置信息，通过这个位置信息，就能从存储引擎里读出该文档。比如"),a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/mmapv1/",target:"_blank",rel:"noopener noreferrer"}},[s._v("mmapv1引擎"),a("OutboundLink")],1),s._v("里，位置信息是`『文件id")]),s._v(" "),a("ul",[a("li",[s._v("文件内offset 』"),a("code",[s._v("， 在[wiredtiger存储引擎](https://docs.mongodb.org/manual/core/wiredtiger/)（一个KV存储引擎）里，位置信息是wiredtiger在存储文档时生成的一个key，通过这个key能访问到对应的文档；为方便介绍，统一用")]),s._v("pos(position的缩写)`来代表位置信息。")])]),s._v(" "),a("p",[s._v("比如上面的例子里，"),a("code",[s._v("person")]),s._v("集合里包含插入了4个文档，假设其存储后位置信息如下(为方便描述，文档省去_id字段)")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("位置信息")]),s._v(" "),a("th",[s._v("文档")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("pos1")]),s._v(" "),a("td",[s._v("{“name” : “jack”, “age” : 19 }")])]),s._v(" "),a("tr",[a("td",[s._v("pos2")]),s._v(" "),a("td",[s._v("{“name” : “rose”, “age” : 20 }")])]),s._v(" "),a("tr",[a("td",[s._v("pos3")]),s._v(" "),a("td",[s._v("{“name” : “jack”, “age” : 18 }")])]),s._v(" "),a("tr",[a("td",[s._v("pos4")]),s._v(" "),a("td",[s._v("{“name” : “tony”, “age” : 21}")])]),s._v(" "),a("tr",[a("td",[s._v("pos5")]),s._v(" "),a("td",[s._v("{“name” : “adam”, “age” : 18}")])])])]),s._v(" "),a("p",[s._v("假设现在有个查询 "),a("code",[s._v("db.person.find( {age: 18} )")]),s._v(",\n查询所有年龄为18岁的人，这时需要遍历所有的文档（『全表扫描』），根据位置信息读出文档，对比age字段是否为18。当然如果只有4个文档，全表扫描的开销并不大，但如果集合文档数量到百万、甚至千万上亿的时候，对集合进行全表扫描开销是非常大的，一个查询耗费数十秒甚至几分钟都有可能。")]),s._v(" "),a("p",[s._v("如果想加速 "),a("code",[s._v("db.person.find( {age: 18} ）")]),s._v("，就可以考虑对person表的age字段"),a("a",{attrs:{href:"https://docs.mongodb.org/manual/reference/method/db.collection.createIndex/",target:"_blank",rel:"noopener noreferrer"}},[s._v("建立索引"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("db.person.createIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  // 按age字段创建升序索引\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("建立索引后，MongoDB会额外存储一份按age字段升序排序的索引数据，索引结构类似如下，索引通常采用类似btree的结构持久化存储，以保证从索引里快速（"),a("code",[s._v("O(logN)的时间复杂度")]),s._v("）找出某个age值对应的位置信息，然后根据位置信息就能读取出对应的文档。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("age")]),s._v(" "),a("th",[s._v("位置信息")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("18")]),s._v(" "),a("td",[s._v("pos3")])]),s._v(" "),a("tr",[a("td",[s._v("18")]),s._v(" "),a("td",[s._v("pos5")])]),s._v(" "),a("tr",[a("td",[s._v("19")]),s._v(" "),a("td",[s._v("pos1")])]),s._v(" "),a("tr",[a("td",[s._v("20")]),s._v(" "),a("td",[s._v("pos2")])]),s._v(" "),a("tr",[a("td",[s._v("21")]),s._v(" "),a("td",[s._v("pos4")])])])]),s._v(" "),a("p",[s._v("简单的说，索引就是将"),a("code",[s._v("文档")]),s._v("按照某个（或某些）字段顺序组织起来，以便能根据该字段高效的查询。有了索引，至少能优化如下场景的效率：")]),s._v(" "),a("ul",[a("li",[s._v("查询，比如查询年龄为18的所有人")]),s._v(" "),a("li",[s._v("更新/删除，将年龄为18的所有人的信息更新或删除，因为更新或删除时，需要根据条件先查询出所有符合条件的文档，所以本质上还是在优化查询")]),s._v(" "),a("li",[s._v("排序，将所有人的信息按年龄排序，如果没有索引，需要全表扫描文档，然后再对扫描的结果进行排序")])]),s._v(" "),a("p",[s._v("众所周知，MongoDB默认会为插入的文档生成_id字段（如果应用本身没有指定该字段），_id是文档唯一的标识，为了保证能根据文档id快递查询文档，MongoDB默认会为集合创建_id字段的索引。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mongo-9552:PRIMARY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("gt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" db.person.getIndexes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" // 查询集合的索引信息\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ns"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.person"')]),s._v(",  // 集合名\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",               // 索引版本\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("              // 索引的字段及排序方向\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           // 根据_id字段升序索引\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id_"')]),s._v("        // 索引的名称\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"mongodb索引类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb索引类型"}},[s._v("#")]),s._v(" MongoDB索引类型")]),s._v(" "),a("p",[s._v("MongoDB支持多种类型的索引，包括单字段索引、复合索引、多key索引、文本索引等，每种类型的索引有不同的使用场合。")]),s._v(" "),a("h3",{attrs:{id:"单字段索引-single-field-index"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单字段索引-single-field-index"}},[s._v("#")]),s._v(" 单字段索引 （Single Field Index）")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("db.person.createIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("上述语句针对age创建了单字段索引，其能加速对age字段的各种查询请求，是最常见的索引形式，MongoDB默认创建的id索引也是这种类型。")]),s._v(" "),a("p",[s._v("{age: 1} 代表升序索引，也可以通过{age: -1}来指定降序索引，对于单字段索引，升序/降序效果是一样的。")]),s._v(" "),a("h3",{attrs:{id:"复合索引-compound-index"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复合索引-compound-index"}},[s._v("#")]),s._v(" 复合索引 (Compound Index)")]),s._v(" "),a("p",[s._v("复合索引是Single Field\nIndex的升级版本，它针对多个字段联合创建索引，先按第一个字段排序，第一个字段相同的文档按第二个字段排序，依次类推，如下针对age,\nname这2个字段创建一个复合索引。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("db.person.createIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", name: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("上述索引对应的数据组织类似下表，与{age: 1}索引不同的时，当age字段相同时，在根据name字段进行排序，所以pos5对应的文档排在pos3之前。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("age")]),s._v(" "),a("th",[s._v("位置信息")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("18")]),s._v(" "),a("td",[s._v("pos5")])]),s._v(" "),a("tr",[a("td",[s._v("18")]),s._v(" "),a("td",[s._v("pos3")])]),s._v(" "),a("tr",[a("td",[s._v("19")]),s._v(" "),a("td",[s._v("pos1")])]),s._v(" "),a("tr",[a("td",[s._v("20")]),s._v(" "),a("td",[s._v("pos2")])]),s._v(" "),a("tr",[a("td",[s._v("21")]),s._v(" "),a("td",[s._v("pos4")])])])]),s._v(" "),a("p",[s._v("复合索引能满足的查询场景比单字段索引更丰富，不光能满足多个字段组合起来的查询，比如"),a("code",[s._v('db.person.find( {age： 18， name: "jack"} )')]),s._v("，也能满足所以能匹配符合索引前缀的查询，这里{age: 1}即为{age: 1, name:\n1}的前缀，所以类似"),a("code",[s._v("db.person.find( {age： 18} )")]),s._v("的查询也能通过该索引来加速；但"),a("code",[s._v('db.person.find( {name: "jack"} )')]),s._v("则无法使用该复合索引。如果经常需要根据『name字段』以及『name和age字段组合』来查询，则应该创建如下的复合索引")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("db.person.createIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("除了查询的需求能够影响索引的顺序，字段的值分布也是一个重要的考量因素，即使person集合所有的查询都是『name和age字段组合』（指定特定的name和age），字段的顺序也是有影响的。")]),s._v(" "),a("p",[s._v("age字段的取值很有限，即拥有相同age字段的文档会有很多；而name字段的取值则丰富很多，拥有相同name字段的文档很少；显然先按name字段查找，再在相同name的文档里查找age字段更为高效。")]),s._v(" "),a("h3",{attrs:{id:"多key索引-multikey-index"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多key索引-multikey-index"}},[s._v("#")]),s._v(" 多key索引 （Multikey Index）")]),s._v(" "),a("p",[s._v("当索引的字段为数组时，创建出的索引称为多key索引，多key索引会为数组的每个元素建立一条索引，比如person表加入一个habbit字段（数组）用于描述兴趣爱好，需要查询有相同兴趣爱好的人就可以利用habbit字段的多key索引。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jack"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(", habbit: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"football, runnning"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndb.person.createIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("habbit: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  // 自动创建多key索引\ndb.person.find"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("habbit: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"football"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"其他类型索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他类型索引"}},[s._v("#")]),s._v(" 其他类型索引")]),s._v(" "),a("p",[s._v("[哈希索引（Hashed Index）](https://docs.mongodb.org/manual/core/index-\nhashed/)是指按照某个字段的hash值来建立索引，目前主要用于"),a("a",{attrs:{href:"https://yq.aliyun.com/articles/32434?spm=5176.100238.yqhn2.22.0cUwgh",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB Sharded\nCluster"),a("OutboundLink")],1),s._v("的Hash分片，hash索引只能满足字段完全匹配的查询，不能满足范围查询等。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/2d/",target:"_blank",rel:"noopener noreferrer"}},[s._v("地理位置索引（Geospatial\nIndex）"),a("OutboundLink")],1),s._v("能很好的解决O2O的应用场景，比如『查找附近的美食』、『查找某个区域内的车站』等。")]),s._v(" "),a("p",[s._v("[文本索引（Text Index）](https://docs.mongodb.org/manual/core/index-\ntext/)能解决快速文本查找的需求，比如有一个博客文章集合，需要根据博客的内容来快速查找，则可以针对博客内容建立文本索引。")]),s._v(" "),a("h3",{attrs:{id:"索引额外属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引额外属性"}},[s._v("#")]),s._v(" 索引额外属性")]),s._v(" "),a("p",[s._v("MongoDB除了支持多种不同类型的索引，还能对索引定制一些特殊的属性。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/v3.0/tutorial/create-a-unique-index/",target:"_blank",rel:"noopener noreferrer"}},[s._v("唯一索引 (unique index)"),a("OutboundLink")],1),s._v("：保证索引对应的字段不会出现相同的值，比如_id索引就是唯一索引")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/index-ttl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TTL索引"),a("OutboundLink")],1),s._v("：可以针对某个时间字段，指定文档的过期时间（经过指定时间后过期 或 在某个时间点过期）")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/index-partial/",target:"_blank",rel:"noopener noreferrer"}},[s._v("部分索引 (partial index)"),a("OutboundLink")],1),s._v(": 只针对符合某个特定条件的文档建立索引，3.2版本才支持该特性")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/index-sparse/",target:"_blank",rel:"noopener noreferrer"}},[s._v("稀疏索引(sparse index)"),a("OutboundLink")],1),s._v(": 只针对存在索引字段的文档建立索引，可看做是部分索引的一种特殊情况")])]),s._v(" "),a("h2",{attrs:{id:"索引优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引优化"}},[s._v("#")]),s._v(" 索引优化")]),s._v(" "),a("h3",{attrs:{id:"db-profiling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#db-profiling"}},[s._v("#")]),s._v(" db profiling")]),s._v(" "),a("p",[s._v("MongoDB支持对DB的请求进行[profiling](https://docs.mongodb.org/manual/tutorial/manage-\nthe-database-profiler/)，目前支持3种级别的profiling。")]),s._v(" "),a("ul",[a("li",[s._v("0： 不开启profiling")]),s._v(" "),a("li",[s._v("1： 将处理时间超过某个阈值(默认100ms)的请求都记录到DB下的system.profile集合 （类似于mysql、redis的slowlog）")]),s._v(" "),a("li",[s._v("2： 将所有的请求都记录到DB下的system.profile集合（生产环境慎用）")])]),s._v(" "),a("p",[s._v("通常，生产环境建议使用1级别的profiling，并根据自身需求配置合理的阈值，用于监测慢请求的情况，并及时的做索引优化。")]),s._v(" "),a("p",[s._v("如果能在集合创建的时候就能『根据业务查询需求决定应该创建哪些索引』，当然是最佳的选择；但由于业务需求多变，要根据实际情况不断的进行优化。索引并不是越多越好，集合的索引太多，会影响写入、更新的性能，每次写入都需要更新所有索引的数据；所以你system.profile里的慢请求可能是索引建立的不够导致，也可能是索引过多导致。")]),s._v(" "),a("h3",{attrs:{id:"查询计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询计划"}},[s._v("#")]),s._v(" 查询计划")]),s._v(" "),a("p",[s._v("索引已经建立了，但查询还是很慢怎么破？这时就得深入的分析下索引的使用情况了，可通过查看下详细的[查询计划](https://docs.mongodb.org/manual/core/query-\nplans/)来决定如何优化。通过执行计划可以看出如下问题")]),s._v(" "),a("ol",[a("li",[s._v("根据某个/些字段查询，但没有建立索引")]),s._v(" "),a("li",[s._v("根据某个/些字段查询，但建立了多个索引，执行查询时没有使用预期的索引。")])]),s._v(" "),a("p",[s._v("建立索引前，"),a("code",[s._v("db.person.find( {age： 18} )")]),s._v("必须执行[COLLSCAN](https://docs.mongodb.org/manual/reference/explain-\nresults/#queryplanner)，即全表扫描。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mongo-9552:PRIMARY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("gt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" db.person.find"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("."),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("explain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"queryPlanner"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plannerVersion"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespace"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.person"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"indexFilterSet"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"parsedQuery"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$eq")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"winningPlan"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stage"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"COLLSCAN"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$eq")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"direction"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"forward"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rejectedPlans"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"serverInfo"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9552")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.2.3"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitVersion"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b326ba837cf6f49d65c2f85e1b70f6f31ece7937"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ok"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("建立索引后，通过查询计划可以看出，先进行[IXSCAN]((https://docs.mongodb.org/manual/reference/explain-\nresults/#queryplanner)(从索引中查找)，然后[FETCH](https://docs.mongodb.org/manual/reference/explain-\nresults/#queryplanner)，读取出满足条件的文档。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mongo-9552:PRIMARY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("gt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" db.person.find"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("."),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("explain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"queryPlanner"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plannerVersion"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespace"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.person"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"indexFilterSet"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"parsedQuery"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$eq")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"winningPlan"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stage"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FETCH"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inputStage"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stage"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IXSCAN"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keyPattern"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"indexName"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age_1"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"isMultiKey"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"isUnique"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"isSparse"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"isPartial"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"indexVersion"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"direction"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"forward"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"indexBounds"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[18.0, 18.0]"')]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rejectedPlans"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"serverInfo"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9552")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.2.3"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitVersion"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b326ba837cf6f49d65c2f85e1b70f6f31ece7937"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ok"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/indexes",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB索引介绍"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/reference/method/db.collection.createIndex/",target:"_blank",rel:"noopener noreferrer"}},[s._v("createIndex命令"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://yq.aliyun.com/articles/32434?spm=5176.100238.yqhn2.22.0cUwgh",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB Sharded Cluster"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/v3.0/tutorial/create-a-unique-index/",target:"_blank",rel:"noopener noreferrer"}},[s._v("唯一索引 (unique index)"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/index-ttl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TTL索引"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/index-partial/",target:"_blank",rel:"noopener noreferrer"}},[s._v("部分索引 (partial index)"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/core/index-sparse/",target:"_blank",rel:"noopener noreferrer"}},[s._v("稀疏索引(sparse index)"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongodb.org/manual/tutorial/manage-the-database-profiler/",target:"_blank",rel:"noopener noreferrer"}},[s._v("database profiling"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://mongoing.com/archives/2789",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB索引原理"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.mongodb.com/docs/manual/indexes/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB 索引"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"作者简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作者简介"}},[s._v("#")]),s._v(" 作者简介")]),s._v(" "),a("p",[s._v("张友东，阿里巴巴技术专家，主要关注分布式存储、Nosql数据库等技术领域，先后参与"),a("a",{attrs:{href:"https://github.com/alibaba/tfs",target:"_blank",rel:"noopener noreferrer"}},[s._v("TFS（淘宝分布式文件系统)"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://www.aliyun.com/product/kvstore",target:"_blank",rel:"noopener noreferrer"}},[s._v("AliCloudDB\nfor Redis"),a("OutboundLink")],1),s._v("等项目，目前主要从事"),a("a",{attrs:{href:"https://www.aliyun.com/product/mongodb",target:"_blank",rel:"noopener noreferrer"}},[s._v("AlidCloud For\nMongoDB"),a("OutboundLink")],1),s._v("的研发工作，致力于让开发者用上最好的MongoDB云服务。")])])}),[],!1,null,null,null);a.default=e.exports}}]);