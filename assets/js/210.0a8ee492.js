(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{541:function(v,t,_){"use strict";_.r(t);var a=_(4),e=Object(a.a)({},(function(){var v=this,t=v._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"sql语言-sql语法基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql语言-sql语法基础"}},[v._v("#")]),v._v(" SQL语言 - SQL语法基础")]),v._v(" "),t("blockquote",[t("p",[v._v("本文包含了所有SQL语言的基础语法，并用例子的方式向你展示。")])]),v._v(" "),t("h2",{attrs:{id:"基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础"}},[v._v("#")]),v._v(" 基础")]),v._v(" "),t("p",[v._v("模式定义了数据如何存储、存储什么样的数据以及数据如何分解等信息，数据库和表都有模式。")]),v._v(" "),t("p",[v._v("主键的值不允许修改，也不允许复用(不能使用已经删除的主键值赋给新数据行的主键)。")]),v._v(" "),t("p",[v._v("SQL(Structured Query Language)，标准 SQL 由 ANSI 标准委员会管理，从而称为 ANSI SQL。各个 DBMS\n都有自己的实现，如 PL/SQL、Transact-SQL 等。")]),v._v(" "),t("p",[v._v("SQL 语句不区分大小写，但是数据库表名、列名和值是否区分依赖于具体的 DBMS 以及配置。")]),v._v(" "),t("p",[v._v("SQL 支持以下三种注释:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("# 注释\nSELECT *\nFROM mytable; -- 注释\n/* 注释1\n   注释2 */\n")])])]),t("p",[v._v("数据库创建与使用:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("CREATE DATABASE test;\nUSE test;\n")])])]),t("h2",{attrs:{id:"创建表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建表"}},[v._v("#")]),v._v(" 创建表")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("CREATE TABLE mytable (\n  id INT NOT NULL AUTO_INCREMENT,\n  col1 INT NOT NULL DEFAULT 1,\n  col2 VARCHAR(45) NULL,\n  col3 DATE NULL,\n  PRIMARY KEY (`id`));\n")])])]),t("h2",{attrs:{id:"修改表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改表"}},[v._v("#")]),v._v(" 修改表")]),v._v(" "),t("p",[v._v("添加列")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("ALTER TABLE mytable\nADD col CHAR(20);\n")])])]),t("p",[v._v("修改列和属性（读者@CodeHourra补充）")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("---ALTER TABLE 表名 CHANGE 原字段名 新字段名 字段类型 约束条件\nALTER TABLE mytable \nCHANGE col col1 CHAR(32) NOT NULL DEFAULT '123';\n")])])]),t("p",[v._v("删除列")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("ALTER TABLE mytable\nDROP COLUMN col;\n")])])]),t("p",[v._v("删除表")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("DROP TABLE mytable;\n")])])]),t("h2",{attrs:{id:"插入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#插入"}},[v._v("#")]),v._v(" 插入")]),v._v(" "),t("p",[v._v("普通插入")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("INSERT INTO mytable(col1, col2)\nVALUES(val1, val2);\n")])])]),t("p",[v._v("插入检索出来的数据")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("INSERT INTO mytable1(col1, col2)\nSELECT col1, col2\nFROM mytable2;\n")])])]),t("p",[v._v("将一个表的内容插入到一个新表")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("CREATE TABLE newtable AS\nSELECT * FROM mytable;\n")])])]),t("h2",{attrs:{id:"更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新"}},[v._v("#")]),v._v(" 更新")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("UPDATE mytable\nSET col = val\nWHERE id = 1;\n")])])]),t("h2",{attrs:{id:"删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[v._v("#")]),v._v(" 删除")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("DELETE FROM mytable\nWHERE id = 1;\n")])])]),t("p",[t("strong",[v._v("TRUNCATE TABLE")]),v._v(" 可以清空表，也就是删除所有行。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("TRUNCATE TABLE mytable;\n")])])]),t("p",[v._v("使用更新和删除操作时一定要用 WHERE 子句，不然会把整张表的数据都破坏。可以先用 SELECT 语句进行测试，防止错误删除。")]),v._v(" "),t("h2",{attrs:{id:"查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[v._v("#")]),v._v(" 查询")]),v._v(" "),t("h3",{attrs:{id:"distinct"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#distinct"}},[v._v("#")]),v._v(" DISTINCT")]),v._v(" "),t("p",[v._v("相同值只会出现一次。它作用于所有列，也就是说所有列的值都相同才算相同。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT DISTINCT col1, col2\nFROM mytable;\n")])])]),t("h3",{attrs:{id:"limit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#limit"}},[v._v("#")]),v._v(" LIMIT")]),v._v(" "),t("p",[v._v("限制返回的行数。可以有两个参数，第一个参数为起始行，从 0 开始；第二个参数为返回的总行数。")]),v._v(" "),t("p",[v._v("返回前 5 行:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable\nLIMIT 5;\n\n\n\nSELECT *\nFROM mytable\nLIMIT 0, 5;\n")])])]),t("p",[v._v("返回第 3 ~ 5 行:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable\nLIMIT 2, 3;\n")])])]),t("h2",{attrs:{id:"排序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排序"}},[v._v("#")]),v._v(" 排序")]),v._v(" "),t("ul",[t("li",[t("strong",[v._v("ASC")]),v._v(" : 升序(默认)")]),v._v(" "),t("li",[t("strong",[v._v("DESC")]),v._v(" : 降序")])]),v._v(" "),t("p",[v._v("可以按多个列进行排序，并且为每个列指定不同的排序方式:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable\nORDER BY col1 DESC, col2 ASC;\n")])])]),t("h2",{attrs:{id:"过滤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#过滤"}},[v._v("#")]),v._v(" 过滤")]),v._v(" "),t("p",[v._v("不进行过滤的数据非常大，导致通过网络传输了多余的数据，从而浪费了网络带宽。因此尽量使用 SQL\n语句来过滤不必要的数据，而不是传输所有的数据到客户端中然后由客户端进行过滤。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable\nWHERE col IS NULL;\n")])])]),t("p",[v._v("下表显示了 WHERE 子句可用的操作符")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("操作符")]),v._v(" "),t("th",[v._v("说明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("=")]),v._v(" "),t("td",[v._v("等于")])]),v._v(" "),t("tr",[t("td",[v._v("<")]),v._v(" "),t("td",[v._v("小于")])]),v._v(" "),t("tr",[t("td",[v._v(">")]),v._v(" "),t("td",[v._v("大于")])]),v._v(" "),t("tr",[t("td",[v._v("<> !=")]),v._v(" "),t("td",[v._v("不等于")])]),v._v(" "),t("tr",[t("td",[v._v("<= !>")]),v._v(" "),t("td",[v._v("小于等于")])]),v._v(" "),t("tr",[t("td",[v._v(">= !<")]),v._v(" "),t("td",[v._v("大于等于")])]),v._v(" "),t("tr",[t("td",[v._v("BETWEEN")]),v._v(" "),t("td",[v._v("在两个值之间")])]),v._v(" "),t("tr",[t("td",[v._v("IS NULL")]),v._v(" "),t("td",[v._v("为 NULL 值")])])])]),v._v(" "),t("p",[v._v("应该注意到，NULL 与 0、空字符串都不同。")]),v._v(" "),t("p",[t("strong",[v._v("AND 和 OR")]),v._v(" 用于连接多个过滤条件。优先处理 AND，当一个过滤表达式涉及到多个 AND 和 OR 时，可以使用 ()\n来决定优先级，使得优先级关系更清晰。")]),v._v(" "),t("p",[t("strong",[v._v("IN")]),v._v(" 操作符用于匹配一组值，其后也可以接一个 SELECT 子句，从而匹配子查询得到的一组值。")]),v._v(" "),t("p",[t("strong",[v._v("NOT")]),v._v(" 操作符用于否定一个条件。")]),v._v(" "),t("h2",{attrs:{id:"通配符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通配符"}},[v._v("#")]),v._v(" 通配符")]),v._v(" "),t("p",[v._v("通配符也是用在过滤语句中，但它只能用于文本字段。")]),v._v(" "),t("ul",[t("li",[t("p",[t("strong",[v._v("%")]),v._v(" 匹配 >=0 个任意字符；")])]),v._v(" "),t("li",[t("p",[t("strong",[v._v("_")]),v._v(" 匹配 ==1 个任意字符；")])]),v._v(" "),t("li",[t("p",[t("strong",[v._v("[ ]")]),v._v(" 可以匹配集合内的字符，例如 [ab] 将匹配字符 a 或者 b。用脱字符 ^ 可以对其进行否定，也就是不匹配集合内的字符。")])])]),v._v(" "),t("p",[v._v("使用 Like 来进行通配符匹配。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable\nWHERE col LIKE '[^AB]%'; -- 不以 A 和 B 开头的任意文本\n")])])]),t("p",[v._v("不要滥用通配符，通配符位于开头处匹配会非常慢。")]),v._v(" "),t("h2",{attrs:{id:"计算字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#计算字段"}},[v._v("#")]),v._v(" 计算字段")]),v._v(" "),t("p",[v._v("在数据库服务器上完成数据的转换和格式化的工作往往比客户端上快得多，并且转换和格式化后的数据量更少的话可以减少网络通信量。")]),v._v(" "),t("p",[v._v("计算字段通常需要使用 "),t("strong",[v._v("AS")]),v._v(" 来取别名，否则输出的时候字段名为计算表达式。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT col1 * col2 AS alias\nFROM mytable;\n")])])]),t("p",[t("strong",[v._v("CONCAT()")]),v._v(" 用于连接两个字段。许多数据库会使用空格把一个值填充为列宽，因此连接的结果会出现一些不必要的空格，使用 "),t("strong",[v._v("TRIM()")]),v._v("\n可以去除首尾空格。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT CONCAT(TRIM(col1), '(', TRIM(col2), ')') AS concat_col\nFROM mytable;\n")])])]),t("h2",{attrs:{id:"函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[v._v("#")]),v._v(" 函数")]),v._v(" "),t("p",[v._v("各个 DBMS 的函数都是不相同的，因此不可移植，以下主要是 MySQL 的函数。")]),v._v(" "),t("h3",{attrs:{id:"汇总"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#汇总"}},[v._v("#")]),v._v(" 汇总")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("函 数")]),v._v(" "),t("th",[v._v("说 明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("AVG()")]),v._v(" "),t("td",[v._v("返回某列的平均值")])]),v._v(" "),t("tr",[t("td",[v._v("COUNT()")]),v._v(" "),t("td",[v._v("返回某列的行数")])]),v._v(" "),t("tr",[t("td",[v._v("MAX()")]),v._v(" "),t("td",[v._v("返回某列的最大值")])]),v._v(" "),t("tr",[t("td",[v._v("MIN()")]),v._v(" "),t("td",[v._v("返回某列的最小值")])]),v._v(" "),t("tr",[t("td",[v._v("SUM()")]),v._v(" "),t("td",[v._v("返回某列值之和")])])])]),v._v(" "),t("p",[v._v("AVG() 会忽略 NULL 行。")]),v._v(" "),t("p",[v._v("使用 DISTINCT 可以让汇总函数值汇总不同的值。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT AVG(DISTINCT col1) AS avg_col\nFROM mytable;\n")])])]),t("h3",{attrs:{id:"文本处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文本处理"}},[v._v("#")]),v._v(" 文本处理")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("函数")]),v._v(" "),t("th",[v._v("说明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("LEFT()")]),v._v(" "),t("td",[v._v("左边的字符")])]),v._v(" "),t("tr",[t("td",[v._v("RIGHT()")]),v._v(" "),t("td",[v._v("右边的字符")])]),v._v(" "),t("tr",[t("td",[v._v("LOWER()")]),v._v(" "),t("td",[v._v("转换为小写字符")])]),v._v(" "),t("tr",[t("td",[v._v("UPPER()")]),v._v(" "),t("td",[v._v("转换为大写字符")])]),v._v(" "),t("tr",[t("td",[v._v("LTRIM()")]),v._v(" "),t("td",[v._v("去除左边的空格")])]),v._v(" "),t("tr",[t("td",[v._v("RTRIM()")]),v._v(" "),t("td",[v._v("去除右边的空格")])]),v._v(" "),t("tr",[t("td",[v._v("LENGTH()")]),v._v(" "),t("td",[v._v("长度")])]),v._v(" "),t("tr",[t("td",[v._v("SOUNDEX()")]),v._v(" "),t("td",[v._v("转换为语音值")])])])]),v._v(" "),t("p",[v._v("其中， "),t("strong",[v._v("SOUNDEX()")]),v._v(" 可以将一个字符串转换为描述其语音表示的字母数字模式。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable\nWHERE SOUNDEX(col1) = SOUNDEX('apple')\n")])])]),t("h3",{attrs:{id:"日期和时间处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日期和时间处理"}},[v._v("#")]),v._v(" 日期和时间处理")]),v._v(" "),t("ul",[t("li",[v._v("日期格式: YYYY-MM-DD")]),v._v(" "),t("li",[v._v("时间格式: HH:MM:SS")])]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("函 数")]),v._v(" "),t("th",[v._v("说 明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("AddDate()")]),v._v(" "),t("td",[v._v("增加一个日期(天、周等)")])]),v._v(" "),t("tr",[t("td",[v._v("AddTime()")]),v._v(" "),t("td",[v._v("增加一个时间(时、分等)")])]),v._v(" "),t("tr",[t("td",[v._v("CurDate()")]),v._v(" "),t("td",[v._v("返回当前日期")])]),v._v(" "),t("tr",[t("td",[v._v("CurTime()")]),v._v(" "),t("td",[v._v("返回当前时间")])]),v._v(" "),t("tr",[t("td",[v._v("Date()")]),v._v(" "),t("td",[v._v("返回日期时间的日期部分")])]),v._v(" "),t("tr",[t("td",[v._v("DateDiff()")]),v._v(" "),t("td",[v._v("计算两个日期之差")])]),v._v(" "),t("tr",[t("td",[v._v("Date_Add()")]),v._v(" "),t("td",[v._v("高度灵活的日期运算函数")])]),v._v(" "),t("tr",[t("td",[v._v("Date_Format()")]),v._v(" "),t("td",[v._v("返回一个格式化的日期或时间串")])]),v._v(" "),t("tr",[t("td",[v._v("Day()")]),v._v(" "),t("td",[v._v("返回一个日期的天数部分")])]),v._v(" "),t("tr",[t("td",[v._v("DayOfWeek()")]),v._v(" "),t("td",[v._v("对于一个日期，返回对应的星期几")])]),v._v(" "),t("tr",[t("td",[v._v("Hour()")]),v._v(" "),t("td",[v._v("返回一个时间的小时部分")])]),v._v(" "),t("tr",[t("td",[v._v("Minute()")]),v._v(" "),t("td",[v._v("返回一个时间的分钟部分")])]),v._v(" "),t("tr",[t("td",[v._v("Month()")]),v._v(" "),t("td",[v._v("返回一个日期的月份部分")])]),v._v(" "),t("tr",[t("td",[v._v("Now()")]),v._v(" "),t("td",[v._v("返回当前日期和时间")])]),v._v(" "),t("tr",[t("td",[v._v("Second()")]),v._v(" "),t("td",[v._v("返回一个时间的秒部分")])]),v._v(" "),t("tr",[t("td",[v._v("Time()")]),v._v(" "),t("td",[v._v("返回一个日期时间的时间部分")])]),v._v(" "),t("tr",[t("td",[v._v("Year()")]),v._v(" "),t("td",[v._v("返回一个日期的年份部分")])])])]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("mysql> SELECT NOW();\n\n\n\n2018-4-14 20:25:11\n")])])]),t("h3",{attrs:{id:"数值处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数值处理"}},[v._v("#")]),v._v(" 数值处理")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("函数")]),v._v(" "),t("th",[v._v("说明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("SIN()")]),v._v(" "),t("td",[v._v("正弦")])]),v._v(" "),t("tr",[t("td",[v._v("COS()")]),v._v(" "),t("td",[v._v("余弦")])]),v._v(" "),t("tr",[t("td",[v._v("TAN()")]),v._v(" "),t("td",[v._v("正切")])]),v._v(" "),t("tr",[t("td",[v._v("ABS()")]),v._v(" "),t("td",[v._v("绝对值")])]),v._v(" "),t("tr",[t("td",[v._v("SQRT()")]),v._v(" "),t("td",[v._v("平方根")])]),v._v(" "),t("tr",[t("td",[v._v("MOD()")]),v._v(" "),t("td",[v._v("余数")])]),v._v(" "),t("tr",[t("td",[v._v("EXP()")]),v._v(" "),t("td",[v._v("指数")])]),v._v(" "),t("tr",[t("td",[v._v("PI()")]),v._v(" "),t("td",[v._v("圆周率")])]),v._v(" "),t("tr",[t("td",[v._v("RAND()")]),v._v(" "),t("td",[v._v("随机数")])])])]),v._v(" "),t("h2",{attrs:{id:"分组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分组"}},[v._v("#")]),v._v(" 分组")]),v._v(" "),t("p",[v._v("分组就是把具有相同的数据值的行放在同一组中。")]),v._v(" "),t("p",[v._v("可以对同一分组数据使用汇总函数进行处理，例如求分组数据的平均值等。")]),v._v(" "),t("p",[v._v("指定的分组字段除了能按该字段进行分组，也会自动按该字段进行排序。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT col, COUNT(*) AS num\nFROM mytable\nGROUP BY col;\n")])])]),t("p",[v._v("GROUP BY 自动按分组字段进行排序，ORDER BY 也可以按汇总字段来进行排序。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT col, COUNT(*) AS num\nFROM mytable\nGROUP BY col\nORDER BY num;\n")])])]),t("p",[v._v("WHERE 过滤行，HAVING 过滤分组，行过滤应当先于分组过滤。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT col, COUNT(*) AS num\nFROM mytable\nWHERE col > 2\nGROUP BY col\nHAVING num >= 2;\n")])])]),t("p",[v._v("分组规定:")]),v._v(" "),t("ul",[t("li",[v._v("GROUP BY 子句出现在 WHERE 子句之后，ORDER BY 子句之前；")]),v._v(" "),t("li",[v._v("除了汇总字段外，SELECT 语句中的每一字段都必须在 GROUP BY 子句中给出；")]),v._v(" "),t("li",[v._v("NULL 的行会单独分为一组；")]),v._v(" "),t("li",[v._v("大多数 SQL 实现不支持 GROUP BY 列具有可变长度的数据类型。")])]),v._v(" "),t("h2",{attrs:{id:"子查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#子查询"}},[v._v("#")]),v._v(" 子查询")]),v._v(" "),t("p",[v._v("子查询中只能返回一个字段的数据。")]),v._v(" "),t("p",[v._v("可以将子查询的结果作为 WHRER 语句的过滤条件:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable1\nWHERE col1 IN (SELECT col2\n               FROM mytable2);\n")])])]),t("p",[v._v("下面的语句可以检索出客户的订单数量，子查询语句会对第一个查询检索出的每个客户执行一次:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT cust_name, (SELECT COUNT(*)\n                   FROM Orders\n                   WHERE Orders.cust_id = Customers.cust_id)\n                   AS orders_num\nFROM Customers\nORDER BY cust_name;\n")])])]),t("h2",{attrs:{id:"连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接"}},[v._v("#")]),v._v(" 连接")]),v._v(" "),t("p",[v._v("连接用于连接多个表，使用 JOIN 关键字，并且条件语句使用 ON 而不是 WHERE。")]),v._v(" "),t("p",[v._v("连接可以替换子查询，并且比子查询的效率一般会更快。")]),v._v(" "),t("p",[v._v("可以用 AS 给列名、计算字段和表名取别名，给表名取别名是为了简化 SQL 语句以及连接相同表。")]),v._v(" "),t("h3",{attrs:{id:"内连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内连接"}},[v._v("#")]),v._v(" 内连接")]),v._v(" "),t("p",[v._v("内连接又称等值连接，使用 INNER JOIN 关键字。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT A.value, B.value\nFROM tablea AS A INNER JOIN tableb AS B\nON A.key = B.key;\n")])])]),t("p",[v._v("可以不明确使用 INNER JOIN，而使用普通查询并在 WHERE 中将两个表中要连接的列用等值方法连接起来。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT A.value, B.value\nFROM tablea AS A, tableb AS B\nWHERE A.key = B.key;\n")])])]),t("p",[v._v("在没有条件语句的情况下返回笛卡尔积。")]),v._v(" "),t("h3",{attrs:{id:"自连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自连接"}},[v._v("#")]),v._v(" 自连接")]),v._v(" "),t("p",[v._v("自连接可以看成内连接的一种，只是连接的表是自身而已。")]),v._v(" "),t("p",[v._v("一张员工表，包含员工姓名和员工所属部门，要找出与 Jim 处在同一部门的所有员工姓名。")]),v._v(" "),t("p",[v._v("子查询版本")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v('SELECT name\nFROM employee\nWHERE department = (\n      SELECT department\n      FROM employee\n      WHERE name = "Jim");\n')])])]),t("p",[v._v("自连接版本")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v('SELECT e1.name\nFROM employee AS e1 INNER JOIN employee AS e2\nON e1.department = e2.department\n      AND e2.name = "Jim";\n')])])]),t("h3",{attrs:{id:"自然连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自然连接"}},[v._v("#")]),v._v(" 自然连接")]),v._v(" "),t("p",[v._v("自然连接是把同名列通过等值测试连接起来的，同名列可以有多个。")]),v._v(" "),t("p",[v._v("内连接和自然连接的区别: 内连接提供连接的列，而自然连接自动连接所有同名列。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT A.value, B.value\nFROM tablea AS A NATURAL JOIN tableb AS B;\n")])])]),t("h3",{attrs:{id:"外连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#外连接"}},[v._v("#")]),v._v(" 外连接")]),v._v(" "),t("p",[v._v("外连接保留了没有关联的那些行。分为左外连接，右外连接以及全外连接，左外连接就是保留左表没有关联的行。")]),v._v(" "),t("p",[v._v("检索所有顾客的订单信息，包括还没有订单信息的顾客。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT Customers.cust_id, Orders.order_num\nFROM Customers LEFT OUTER JOIN Orders\nON Customers.cust_id = Orders.cust_id;\n")])])]),t("p",[v._v("customers 表:")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("cust_id")]),v._v(" "),t("th",[v._v("cust_name")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("1")]),v._v(" "),t("td",[v._v("a")])]),v._v(" "),t("tr",[t("td",[v._v("2")]),v._v(" "),t("td",[v._v("b")])]),v._v(" "),t("tr",[t("td",[v._v("3")]),v._v(" "),t("td",[v._v("c")])])])]),v._v(" "),t("p",[v._v("orders 表:")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("order_id")]),v._v(" "),t("th",[v._v("cust_id")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("1")]),v._v(" "),t("td",[v._v("1")])]),v._v(" "),t("tr",[t("td",[v._v("2")]),v._v(" "),t("td",[v._v("1")])]),v._v(" "),t("tr",[t("td",[v._v("3")]),v._v(" "),t("td",[v._v("3")])]),v._v(" "),t("tr",[t("td",[v._v("4")]),v._v(" "),t("td",[v._v("3")])])])]),v._v(" "),t("p",[v._v("结果:")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("cust_id")]),v._v(" "),t("th",[v._v("cust_name")]),v._v(" "),t("th",[v._v("order_id")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("1")]),v._v(" "),t("td",[v._v("a")]),v._v(" "),t("td",[v._v("1")])]),v._v(" "),t("tr",[t("td",[v._v("1")]),v._v(" "),t("td",[v._v("a")]),v._v(" "),t("td",[v._v("2")])]),v._v(" "),t("tr",[t("td",[v._v("3")]),v._v(" "),t("td",[v._v("c")]),v._v(" "),t("td",[v._v("3")])]),v._v(" "),t("tr",[t("td",[v._v("3")]),v._v(" "),t("td",[v._v("c")]),v._v(" "),t("td",[v._v("4")])]),v._v(" "),t("tr",[t("td",[v._v("2")]),v._v(" "),t("td",[v._v("b")]),v._v(" "),t("td",[v._v("Null")])])])]),v._v(" "),t("h2",{attrs:{id:"组合查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#组合查询"}},[v._v("#")]),v._v(" 组合查询")]),v._v(" "),t("p",[v._v("使用 "),t("strong",[v._v("UNION")]),v._v(" 来组合两个查询，如果第一个查询返回 M 行，第二个查询返回 N 行，那么组合查询的结果一般为 M+N 行。")]),v._v(" "),t("p",[v._v("每个查询必须包含相同的列、表达式和聚集函数。")]),v._v(" "),t("p",[v._v("默认会去除相同行，如果需要保留相同行，使用 UNION ALL。")]),v._v(" "),t("p",[v._v("只能包含一个 ORDER BY 子句，并且必须位于语句的最后。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT col\nFROM mytable\nWHERE col = 1\nUNION\nSELECT col\nFROM mytable\nWHERE col =2;\n")])])]),t("h2",{attrs:{id:"视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#视图"}},[v._v("#")]),v._v(" 视图")]),v._v(" "),t("p",[v._v("视图是虚拟的表，本身不包含数据，也就不能对其进行索引操作。")]),v._v(" "),t("p",[v._v("对视图的操作和对普通表的操作一样。")]),v._v(" "),t("p",[v._v("视图具有如下好处:")]),v._v(" "),t("ul",[t("li",[t("p",[v._v("简化复杂的 SQL 操作，比如复杂的连接；")])]),v._v(" "),t("li",[t("p",[v._v("只使用实际表的一部分数据；")])]),v._v(" "),t("li",[t("p",[v._v("通过只给用户访问视图的权限，保证数据的安全性；")])]),v._v(" "),t("li",[t("p",[v._v("更改数据格式和表示。")]),v._v(" "),t("p",[v._v("CREATE VIEW myview AS\nSELECT Concat(col1, col2) AS concat_col, col3*col4 AS compute_col\nFROM mytable\nWHERE col5 = val;")])])]),v._v(" "),t("h2",{attrs:{id:"存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程"}},[v._v("#")]),v._v(" 存储过程")]),v._v(" "),t("p",[v._v("存储过程可以看成是对一系列 SQL 操作的批处理。")]),v._v(" "),t("p",[v._v("使用存储过程的好处:")]),v._v(" "),t("ul",[t("li",[v._v("代码封装，保证了一定的安全性；")]),v._v(" "),t("li",[v._v("代码复用；")]),v._v(" "),t("li",[v._v("由于是预先编译，因此具有很高的性能。")])]),v._v(" "),t("p",[v._v("命令行中创建存储过程需要自定义分隔符，因为命令行是以 ; 为结束符，而存储过程中也包含了分号，因此会错误把这部分分号当成是结束符，造成语法错误。")]),v._v(" "),t("p",[v._v("包含 in、out 和 inout 三种参数。")]),v._v(" "),t("p",[v._v("给变量赋值都需要用 select into 语句。")]),v._v(" "),t("p",[v._v("每次只能给一个变量赋值，不支持集合的操作。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("delimiter //\n\ncreate procedure myprocedure( out ret int )\n    begin\n        declare y int;\n        select sum(col1)\n        from mytable\n        into y;\n        select y*y into ret;\n    end //\n\ndelimiter ;\n\n\n\ncall myprocedure(@ret);\nselect @ret;\n")])])]),t("h2",{attrs:{id:"游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#游标"}},[v._v("#")]),v._v(" 游标")]),v._v(" "),t("p",[v._v("在存储过程中使用游标可以对一个结果集进行移动遍历。")]),v._v(" "),t("p",[v._v("游标主要用于交互式应用，其中用户需要对数据集中的任意行进行浏览和修改。")]),v._v(" "),t("p",[v._v("使用游标的四个步骤:")]),v._v(" "),t("ol",[t("li",[v._v("声明游标，这个过程没有实际检索出数据；")]),v._v(" "),t("li",[v._v("打开游标；")]),v._v(" "),t("li",[v._v("取出数据；")]),v._v(" "),t("li",[v._v("关闭游标；")])]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("delimiter //\ncreate procedure myprocedure(out ret int)\n    begin\n        declare done boolean default 0;\n\n        declare mycursor cursor for\n        select col1 from mytable;\n        # 定义了一个 continue handler，当 sqlstate '02000' 这个条件出现时，会执行 set done = 1\n        declare continue handler for sqlstate '02000' set done = 1;\n\n        open mycursor;\n\n        repeat\n            fetch mycursor into ret;\n            select ret;\n        until done end repeat;\n\n        close mycursor;\n    end //\n delimiter ;\n")])])]),t("h2",{attrs:{id:"触发器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#触发器"}},[v._v("#")]),v._v(" 触发器")]),v._v(" "),t("p",[v._v("触发器会在某个表执行以下语句时而自动执行: DELETE、INSERT、UPDATE。")]),v._v(" "),t("p",[v._v("触发器必须指定在语句执行之前还是之后自动执行，之前执行使用 BEFORE 关键字，之后执行使用 AFTER 关键字。BEFORE\n用于数据验证和净化，AFTER 用于审计跟踪，将修改记录到另外一张表中。")]),v._v(" "),t("p",[v._v("INSERT 触发器包含一个名为 NEW 的虚拟表。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("CREATE TRIGGER mytrigger AFTER INSERT ON mytable\nFOR EACH ROW SELECT NEW.col into @result;\n\nSELECT @result; -- 获取结果\n")])])]),t("p",[v._v("DELETE 触发器包含一个名为 OLD 的虚拟表，并且是只读的。")]),v._v(" "),t("p",[v._v("UPDATE 触发器包含一个名为 NEW 和一个名为 OLD 的虚拟表，其中 NEW 是可以被修改的，而 OLD 是只读的。")]),v._v(" "),t("p",[v._v("MySQL 不允许在触发器中使用 CALL 语句，也就是不能调用存储过程。")]),v._v(" "),t("h2",{attrs:{id:"事务管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务管理"}},[v._v("#")]),v._v(" 事务管理")]),v._v(" "),t("p",[v._v("基本术语:")]),v._v(" "),t("ul",[t("li",[v._v("事务(transaction)指一组 SQL 语句；")]),v._v(" "),t("li",[v._v("回退(rollback)指撤销指定 SQL 语句的过程；")]),v._v(" "),t("li",[v._v("提交(commit)指将未存储的 SQL 语句结果写入数据库表；")]),v._v(" "),t("li",[v._v("保留点(savepoint)指事务处理中设置的临时占位符(placeholder)，你可以对它发布回退(与回退整个事务处理不同)。")])]),v._v(" "),t("p",[v._v("不能回退 SELECT 语句，回退 SELECT 语句也没意义；也不能回退 CREATE 和 DROP 语句。")]),v._v(" "),t("p",[v._v("MySQL 的事务提交默认是隐式提交，每执行一条语句就把这条语句当成一个事务然后进行提交。当出现 START TRANSACTION\n语句时，会关闭隐式提交；当 COMMIT 或 ROLLBACK 语句执行后，事务会自动关闭，重新恢复隐式提交。")]),v._v(" "),t("p",[v._v("通过设置 autocommit 为 0 可以取消自动提交；autocommit 标记是针对每个连接而不是针对服务器的。")]),v._v(" "),t("p",[v._v("如果没有设置保留点，ROLLBACK 会回退到 START TRANSACTION 语句处；如果设置了保留点，并且在 ROLLBACK\n中指定该保留点，则会回退到该保留点。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("START TRANSACTION\n// ...\nSAVEPOINT delete1\n// ...\nROLLBACK TO delete1\n// ...\nCOMMIT\n")])])]),t("h2",{attrs:{id:"字符集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字符集"}},[v._v("#")]),v._v(" 字符集")]),v._v(" "),t("p",[v._v("基本术语:")]),v._v(" "),t("ul",[t("li",[v._v("字符集为字母和符号的集合；")]),v._v(" "),t("li",[v._v("编码为某个字符集成员的内部表示；")]),v._v(" "),t("li",[v._v("校对字符指定如何比较，主要用于排序和分组。")])]),v._v(" "),t("p",[v._v("除了给表指定字符集和校对外，也可以给列指定:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("CREATE TABLE mytable\n(col VARCHAR(10) CHARACTER SET latin COLLATE latin1_general_ci )\nDEFAULT CHARACTER SET hebrew COLLATE hebrew_general_ci;\n")])])]),t("p",[v._v("可以在排序、分组时指定校对:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SELECT *\nFROM mytable\nORDER BY col COLLATE latin1_general_ci;\n")])])]),t("h2",{attrs:{id:"权限管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#权限管理"}},[v._v("#")]),v._v(" 权限管理")]),v._v(" "),t("p",[v._v("MySQL 的账户信息保存在 mysql 这个数据库中。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("USE mysql;\nSELECT user FROM user;\n")])])]),t("p",[t("strong",[v._v("创建账户")])]),v._v(" "),t("p",[v._v("新创建的账户没有任何权限。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("CREATE USER myuser IDENTIFIED BY 'mypassword';\n")])])]),t("p",[t("strong",[v._v("修改账户名")])]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v(" RENAME myuser TO newuser;\n")])])]),t("p",[t("strong",[v._v("删除账户")])]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v(" DROP USER myuser;\n")])])]),t("p",[t("strong",[v._v("查看权限")])]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v(" SHOW GRANTS FOR myuser;\n")])])]),t("p",[t("strong",[v._v("授予权限")])]),v._v(" "),t("p",[v._v("账户用 username@host 的形式定义，username@% 使用的是默认主机名。")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("GRANT SELECT, INSERT ON mydatabase.* TO myuser;\n")])])]),t("p",[t("strong",[v._v("删除权限")])]),v._v(" "),t("p",[v._v("GRANT 和 REVOKE 可在几个层次上控制访问权限:")]),v._v(" "),t("ul",[t("li",[t("p",[v._v("整个服务器，使用 GRANT ALL 和 REVOKE ALL；")])]),v._v(" "),t("li",[t("p",[v._v("整个数据库，使用 ON database.*；")])]),v._v(" "),t("li",[t("p",[v._v("特定的表，使用 ON database.table；")])]),v._v(" "),t("li",[t("p",[v._v("特定的列；")])]),v._v(" "),t("li",[t("p",[v._v("特定的存储过程。")]),v._v(" "),t("p",[v._v("REVOKE SELECT, INSERT ON mydatabase.* FROM myuser;")])])]),v._v(" "),t("p",[t("strong",[v._v("更改密码")])]),v._v(" "),t("p",[v._v("必须使用 Password() 函数")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[v._v("SET PASSWROD FOR myuser = Password('new_password');\n")])])]),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[v._v("#")]),v._v(" 参考资料")]),v._v(" "),t("ul",[t("li",[v._v("BenForta. SQL 必知必会 [M]. 人民邮电出版社, 2013.")])])])}),[],!1,null,null,null);t.default=e.exports}}]);