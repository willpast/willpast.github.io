(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{436:function(a,s,t){"use strict";t.r(s);var n=t(4),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"调试排错-java-问题排查之工具单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调试排错-java-问题排查之工具单"}},[a._v("#")]),a._v(" 调试排错 - Java 问题排查之工具单")]),a._v(" "),s("blockquote",[s("p",[a._v("Java 在线问题排查主要分两篇：本文是第二篇，通过java调试/排查工具进行问题定位。")])]),a._v(" "),s("h2",{attrs:{id:"_1-java-调试入门工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-java-调试入门工具"}},[a._v("#")]),a._v(" 1. Java 调试入门工具")]),a._v(" "),s("h3",{attrs:{id:"_1-1-jps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-jps"}},[a._v("#")]),a._v(" 1.1 jps")]),a._v(" "),s("blockquote",[s("p",[a._v("jps是jdk提供的一个查看当前java进程的小工具， 可以看做是JavaVirtual Machine Process Status Tool的缩写。")])]),a._v(" "),s("p",[a._v("jps常用命令")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("jps "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示进程的ID 和 类的名称")]),a._v("\njps –l "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出输出完全的包名，应用主类名，jar的完全路径名 ")]),a._v("\njps –v "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出jvm参数")]),a._v("\njps –q "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示java进程号")]),a._v("\njps "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# main 方法")]),a._v("\njps "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" xxx.xxx.xx.xx "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 远程查看 ")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("jps参数")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("-q：仅输出VM标识符，不包括classname,jar name,arguments "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" main method \n-m：输出main method的参数 \n-l：输出完全的包名，应用主类名，jar的完全路径名 \n-v：输出jvm参数 \n-V：输出通过flag文件传递到JVM中的参数"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(".hotspotrc文件或-XX:Flags"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("所指定的文件 \n-Joption：传递参数到vm,例如:-J-Xms512m\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("jps原理")]),a._v(" "),s("blockquote",[s("p",[a._v("java程序在启动以后，会在java.io.tmpdir指定的目录下，就是临时文件夹里，生成一个类似于hsperfdata_User的文件夹，这个文件夹里（在Linux中为/tmp/hsperfdata_{userName}/），有几个文件，名字就是java进程的pid，因此列出当前运行的java进程，只是把这个目录里的文件名列一下而已。 至于系统的参数什么，就可以解析这几个文件获得。")])]),a._v(" "),s("p",[a._v("更多请参考 "),s("a",{attrs:{href:"https://docs.oracle.com/javase/1.5.0/docs/tooldocs/share/jps.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("jps - Java Virtual Machine Process Status Tool"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_1-2-jstack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-jstack"}},[a._v("#")]),a._v(" 1.2 jstack")]),a._v(" "),s("blockquote",[s("p",[a._v("jstack是jdk自带的线程堆栈分析工具，使用该命令可以查看或导出 Java 应用程序中线程堆栈信息。")])]),a._v(" "),s("p",[a._v("jstack常用命令:")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 基本")]),a._v("\njstack "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# java和native c/c++框架的所有栈信息")]),a._v("\njstack "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 额外的锁信息列表，查看是否死锁")]),a._v("\njstack "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("jstack参数：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" 长列表. 打印关于锁的附加信息,例如属于java.util.concurrent 的 ownable synchronizers列表.\n\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-F")]),a._v(" 当’jstack "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("-l"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" pid’没有相应的时候强制打印栈信息\n\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" 打印java和native c/c++框架的所有栈信息.\n\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-help")]),a._v(" 打印帮助信息\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("更多请参考: "),s("a",{attrs:{href:"https://www.jianshu.com/p/025cb069cb69",target:"_blank",rel:"noopener noreferrer"}},[a._v("jvm 性能调优工具之 jstack"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_1-3-jinfo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-jinfo"}},[a._v("#")]),a._v(" 1.3 jinfo")]),a._v(" "),s("blockquote",[s("p",[a._v("jinfo 是 JDK 自带的命令，可以用来查看正在运行的 java 应用程序的扩展参数，包括Java System属性和JVM命令行参数；也可以动态的修改正在运行的 JVM 一些参数。当系统崩溃时，jinfo可以从core文件里面知道崩溃的Java应用程序的配置信息")])]),a._v(" "),s("p",[a._v("jinfo常用命令:")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出当前 jvm 进程的全部参数和系统属性")]),a._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出所有的参数")]),a._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flags")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看指定的 jvm 参数的值")]),a._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flag")]),a._v(" PrintGC "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开启/关闭指定的JVM参数")]),a._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flag")]),a._v(" +PrintGC "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置flag的参数")]),a._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flag")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出当前 jvm 进行的全部的系统属性")]),a._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sysprops")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("p",[a._v("jinfo参数：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("no option 输出全部的参数和系统属性\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flag")]),a._v(" name 输出对应名称的参数\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flag")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("+"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("name 开启或者关闭对应名称的参数\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flag")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("value 设定对应名称的参数\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-flags")]),a._v(" 输出全部的参数\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sysprops")]),a._v(" 输出系统属性\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("更多请参考："),s("a",{attrs:{href:"https://www.jianshu.com/p/8d8aef212b25",target:"_blank",rel:"noopener noreferrer"}},[a._v("jvm 性能调优工具之 jinfo"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_1-4-jmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-jmap"}},[a._v("#")]),a._v(" 1.4 jmap")]),a._v(" "),s("blockquote",[s("p",[a._v("命令jmap是一个多功能的命令。它可以生成 java 程序的 dump 文件， 也可以查看堆内对象示例的统计信息、查看 ClassLoader 的信息以及 finalizer 队列。")])]),a._v(" "),s("p",[a._v("两个用途")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看堆的情况")]),a._v("\njmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-heap")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dump")]),a._v("\njmap -dump:live,format"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("b,file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/tmp/heap2.bin "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\njmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-dump:format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("b,file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/tmp/heap3.bin "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看堆的占用")]),a._v("\njmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-histo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2815")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-10")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("jmap参数")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("no option： 查看进程的内存映像信息,类似 Solaris pmap 命令。\nheap： 显示Java堆详细信息\nhisto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(":live"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("： 显示堆中对象的统计信息\nclstats：打印类加载器信息\nfinalizerinfo： 显示在F-Queue队列等待Finalizer线程执行finalizer方法的对象\ndump:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("dump-options"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("：生成堆转储快照\nF： 当-dump没有响应时，使用-dump或者-histo参数. 在这个模式下,live子参数无效.\nhelp：打印帮助信息\nJ"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("flag"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("：指定传递给运行jmap的JVM的参数\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("更多请参考："),s("a",{attrs:{href:"https://www.jianshu.com/p/a4ad53179df3",target:"_blank",rel:"noopener noreferrer"}},[a._v("jvm 性能调优工具之 jmap"),s("OutboundLink")],1),a._v(" 和 "),s("a",{attrs:{href:"https://docs.oracle.com/javase/1.5.0/docs/tooldocs/share/jmap.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("jmap - Memory Map"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_1-5-jdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-jdb"}},[a._v("#")]),a._v(" 1.5 jdb")]),a._v(" "),s("p",[a._v("jdb可以用来预发debug,假设你预发的java_home是/opt/java/，远程调试端口是8000.那么")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("jdb "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-attach")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8000")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("出现以上代表jdb启动成功。后续可以进行设置断点进行调试。")]),a._v(" "),s("p",[a._v("具体参数可见oracle官方说明"),s("a",{attrs:{href:"http://docs.oracle.com/javase/7/docs/technotes/tools/windows/jdb.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("jdb - The Java Debugger"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_1-6-chlsdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-chlsdb"}},[a._v("#")]),a._v(" 1.6 CHLSDB")]),a._v(" "),s("p",[a._v("CHLSDB感觉很多情况下可以看到更好玩的东西，不详细叙述了。 查询资料听说jstack和jmap等工具就是基于它的。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-classpath")]),a._v(" /opt/taobao/java/lib/sa-jdi.jar sun.jvm.hotspot.CLHSDB\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("更详细的可见R大此贴 http://rednaxelafx.iteye.com/blog/1847971")]),a._v(" "),s("h2",{attrs:{id:"_2-java-调试进阶工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-java-调试进阶工具"}},[a._v("#")]),a._v(" 2. Java 调试进阶工具")]),a._v(" "),s("h3",{attrs:{id:"_2-1-btrace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-btrace"}},[a._v("#")]),a._v(" 2.1 btrace")]),a._v(" "),s("p",[a._v("首当其冲的要说的是btrace。真是生产环境&预发的排查问题大杀器。 简介什么的就不说了。直接上代码干")]),a._v(" "),s("ul",[s("li",[a._v("查看当前谁调用了ArrayList的add方法，同时只打印当前ArrayList的size大于500的线程调用栈")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@OnMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("clazz "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java.util.ArrayList"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" method"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"add"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" location "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Location")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CALL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" clazz "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/./"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" method "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/./"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("m")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@ProbeClassName")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" probeClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@ProbeMethodName")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" probeMethod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TargetInstance")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TargetMethodOrField")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getInt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("field")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java.util.ArrayList"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"size"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("479")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"check who ArrayList.add method:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" probeClass "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"#"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" probeMethod  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('", method:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" method "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('", size:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getInt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("field")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java.util.ArrayList"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"size"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("jstack")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"==========================="')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("ul",[s("li",[a._v("监控当前服务方法被调用时返回的值以及请求的参数")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@OnMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("clazz "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"com.taobao.sellerhome.transfer.biz.impl.C2CApplyerServiceImpl"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" method"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nav"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" location "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Location")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("RETURN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" relation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" check"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" redirectUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AnyType")]),a._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"parameter# userId:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('", current:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" current "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('", relation:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" relation "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('", check:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" check "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('", redirectUrl:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" redirectUrl "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('", result:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("btrace 具体可以参考这里：https://github.com/btraceio/btrace")]),a._v(" "),s("p",[a._v("注意:")]),a._v(" "),s("ul",[s("li",[a._v("经过观察，1.3.9的release输出不稳定，要多触发几次才能看到正确的结果")]),a._v(" "),s("li",[a._v("正则表达式匹配trace类时范围一定要控制，否则极有可能出现跑满CPU导致应用卡死的情况")]),a._v(" "),s("li",[a._v("由于是字节码注入的原理，想要应用恢复到正常情况，需要重启应用。")])]),a._v(" "),s("h3",{attrs:{id:"_2-2-greys"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-greys"}},[a._v("#")]),a._v(" 2.2 Greys")]),a._v(" "),s("p",[a._v("Greys是@杜琨的大作吧。说几个挺棒的功能(部分功能和btrace重合):")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("sc -df xxx")]),a._v(": 输出当前类的详情,包括源码位置和classloader结构")]),a._v(" "),s("li",[s("code",[a._v("trace class method")]),a._v(": 打印出当前方法调用的耗时情况，细分到每个方法, 对排查方法性能时很有帮助。")])]),a._v(" "),s("h3",{attrs:{id:"_2-3-arthas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-arthas"}},[a._v("#")]),a._v(" 2.3 Arthas")]),a._v(" "),s("blockquote",[s("p",[a._v("Arthas是基于Greys。")])]),a._v(" "),s("p",[a._v("具体请参考："),s("a",{attrs:{href:"https://pdai.tech/md/java/jvm/java-jvm-agent-arthas.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("调试排错 - Java应用在线调试Arthas"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_2-4-javosize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-javosize"}},[a._v("#")]),a._v(" 2.4 javOSize")]),a._v(" "),s("p",[a._v("就说一个功能:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("classes")]),a._v("：通过修改了字节码，改变了类的内容，即时生效。 所以可以做到快速的在某个地方打个日志看看输出，缺点是对代码的侵入性太大。但是如果自己知道自己在干嘛，的确是不错的玩意儿。")])]),a._v(" "),s("p",[a._v("其他功能Greys和btrace都能很轻易做的到，不说了。")]),a._v(" "),s("p",[a._v("更多请参考："),s("a",{attrs:{href:"http://www.javosize.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("官网"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_2-5-jprofiler"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-jprofiler"}},[a._v("#")]),a._v(" 2.5 JProfiler")]),a._v(" "),s("p",[a._v("之前判断许多问题要通过JProfiler，但是现在Greys和btrace基本都能搞定了。再加上出问题的基本上都是生产环境(网络隔离)，所以基本不怎么使用了，但是还是要标记一下。")]),a._v(" "),s("p",[a._v("更多请参考："),s("a",{attrs:{href:"https://www.ej-technologies.com/products/jprofiler/overview.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("官网  (opens new window)"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"_3-其它工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-其它工具"}},[a._v("#")]),a._v(" 3. 其它工具")]),a._v(" "),s("h3",{attrs:{id:"_3-1-dmesg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-dmesg"}},[a._v("#")]),a._v(" 3.1 dmesg")]),a._v(" "),s("p",[a._v("如果发现自己的java进程悄无声息的消失了，几乎没有留下任何线索，那么dmesg一发，很有可能有你想要的。")]),a._v(" "),s("p",[a._v("sudo dmesg|grep -i kill|less 去找关键字oom_killer。找到的结果类似如下:")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6710782.021013")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" invoked oom-killer: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("gfp_mask")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("0xd0, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("order")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("oom_adj")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("oom_scoe_adj")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6710782.070639")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("ffffffff8111889"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("8")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ? oom_kill_process+0x68/0x140 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6710782.257588")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Task "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" /LXC011175068174 killed as a result of limit of /LXC011175068174 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6710784.698347")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Memory cgroup out of memory: Kill process "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("215701")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" score "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("854")]),a._v(" or sacrifice child \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6710784.707978")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Killed process "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("215701")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("UID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("679")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" total-vm:11017300kB, anon-rss:7152432kB, file-rss:1232kB\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("以上表明，对应的java进程被系统的OOM Killer给干掉了，得分为854. 解释一下OOM killer（Out-Of-Memory killer），该机制会监控机器的内存资源消耗。当机器内存耗尽前，该机制会扫描所有的进程（按照一定规则计算，内存占用，时间等），挑选出得分最高的进程，然后杀死，从而保护机器。")]),a._v(" "),s("p",[a._v("dmesg日志时间转换公式: log实际时间=格林威治1970-01-01+(当前时间秒数-系统启动至今的秒数+dmesg打印的log时间)秒数：")]),a._v(" "),s("p",[a._v('date -d "1970-01-01 UTC '),s("code",[a._v("echo \"$(date +%s)-$(cat /proc/uptime|cut -f 1 -d' ')+12288812.926194\"|bc")]),a._v(' seconds" 剩下的，就是看看为什么内存这么大，触发了OOM-Killer了。')]),a._v(" "),s("h2",{attrs:{id:"参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://pdai.tech/md/java/jvm/java-jvm-debug-tools-list.html",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[a._v("调试排错 - Java 问题排查之工具单")]),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);